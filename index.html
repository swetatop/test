<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military Academy / UG5</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <style>
        :root {
            --bg: #0D0F15;
            --card: #1A1D25;
            --accent: #2A2E3A;
            --text: #FFFFFF;
            --primary: linear-gradient(135deg, #5D8C42 0%, #3A5C2A 100%);
            --primary-hover: linear-gradient(135deg, #6D9C52 0%, #4A6C3A 100%);
            --card-gradient: linear-gradient(135deg, #151820 0%, #2A3A1A 100%);
            --card-gradient-hover: linear-gradient(135deg, #252830 0%, #3A4A2A 100%);
            --text-gray: #CCCCCC;
            --success: #4CAF50;
            --error: #f44336;
            --warning: #ff9800;
            --info: #2196F3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            font-family: 'Inter', Arial, sans-serif;
        }

        h1, h2, h3, h4 {
            font-family: 'Inter', Arial, sans-serif;
            text-shadow: 0 1px 2px rgba(255,255,255,0.1);
        }
        
        h1 { font-weight: 700; font-size: 2.5rem; }
        h2 { font-weight: 600; font-size: 2rem; }
        h3 { font-weight: 500; font-size: 1.5rem; }
        
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(42, 46, 58, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(42, 58, 26, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(93, 140, 66, 0.15) 0%, transparent 50%);
            z-index: -1;
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .auth-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-content {
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-gray);
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            background: rgba(13, 15, 21, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: var(--text);
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #5D8C42;
        }
        
        .auth-button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            border: none;
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
            margin-top: 10px;
        }
        
        .auth-button:hover {
            background: var(--primary-hover);
        }
        
        .auth-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        
        .auth-message.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--success);
            display: block;
        }
        
        .auth-message.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid var(--error);
            display: block;
        }
        
        /* User Panel */
        .user-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info {
            background: var(--primary);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .admin-button {
            background: var(--primary);
            border: none;
            color: var(--text);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .admin-button:hover {
            background: var(--primary-hover);
        }
        
        .login-button {
            background: var(--primary);
            border: none;
            color: var(--text);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .login-button:hover {
            background: var(--primary-hover);
        }
        
        /* Admin Panel */
        .admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            z-index: 2001;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .admin-overlay.active {
            display: block;
        }
        
        .users-info {
            background: rgba(13, 15, 21, 0.6);
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #5D8C42;
        }
        
        .users-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–æ–≤ */
        .logs-section {
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .logs-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(26, 29, 37, 0.6);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .log-item {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: rgba(42, 46, 58, 0.8);
            border-radius: 6px;
            border-left: 4px solid #5D8C42;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .log-item:hover {
            background: rgba(42, 46, 58, 0.9);
            transform: translateX(2px);
        }
        
        .log-time {
            color: var(--text-gray);
            font-size: 11px;
            margin-right: 10px;
        }
        
        .log-user {
            color: #5D8C42;
            font-weight: bold;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .add-card-btn {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-card-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .delete-card-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            opacity: 0;
            transition: all 0.3s ease;
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .chapter-card:hover .delete-card-btn {
            opacity: 1;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ - –£–ü–†–û–©–ï–ù–ù–û–ï */
        .card-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .card-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-modal-content {
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }
        
        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: rgba(26, 29, 37, 0.95);
            backdrop-filter: blur(10px);
            transition: left 0.3s ease;
            z-index: 1000;
            padding: 20px;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar.active ~ .menu-toggle {
            left: 260px;
            transition: left 0.3s ease;
        }
        
        .menu-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary);
            border: none;
            color: var(--text);
            font-size: 16px;
            padding: 10px 15px;
            cursor: pointer;
            z-index: 1001;
            border-radius: 6px;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .menu-toggle:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        .sidebar h2 {
            color: var(--text);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.25rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .sidebar-nav {
            list-style: none;
            margin-bottom: 30px;
        }
        
        .sidebar-nav li {
            margin-bottom: 10px;
            position: relative;
        }
        
        .sidebar-nav a {
            color: var(--text);
            text-decoration: none;
            font-size: 14px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: 6px;
            transition: all 0.3s;
            border: 1px solid transparent;
            background: rgba(42, 46, 58, 0.6);
        }
        
        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: var(--primary);
            border-color: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .discord-link {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .discord-link a {
            color: var(--text);
            text-decoration: none;
            font-size: 14px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: 6px;
            transition: all 0.3s;
            border: 1px solid transparent;
            background: rgba(42, 46, 58, 0.6);
        }
        
        .discord-link a:hover {
            background: var(--primary);
            border-color: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        
        /* Dropdown Styles */
        .dropdown-content {
            display: none;
            position: absolute;
            left: 100%;
            top: 0;
            background: rgba(26, 29, 37, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 10px;
            min-width: 200px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 1002;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .dropdown-content a {
            margin-bottom: 5px;
            font-size: 13px;
            padding: 8px 12px;
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }
        
        /* Welcome Section */
        .welcome-section {
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .welcome-section h1 {
            color: #FFFFFF;
            margin-bottom: 15px;
            font-size: 2rem;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        
        .welcome-section p {
            color: var(--text-gray);
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Quick Cards */
        .quick-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .card {
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            background: var(--card-gradient-hover);
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        
        .card h3 {
            font-size: 1.5rem;
            color: #FFFFFF;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        
        /* Pages */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Chapters Grid */
        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .chapter-card {
            background: var(--card-gradient);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .chapter-card:hover {
            background: var(--card-gradient-hover);
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        
        .chapter-card h4 {
            font-size: 1.1rem;
            color: #FFFFFF;
            line-height: 1.4;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        
        /* Content Pages */
        .content-page {
            background: rgba(26, 29, 37, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            min-height: 500px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .content-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .content-body {
            line-height: 1.8;
            color: var(--text-gray);
            margin-bottom: 30px;
            font-family: 'Arial', sans-serif;
        }
        
        .content-body a {
            color: #5D8C42 !important;
            text-decoration: none !important;
            border-bottom: 1px solid #5D8C42;
            transition: all 0.3s ease;
            cursor: pointer !important;
        }
        
        .content-body a:hover {
            color: #6D9C52 !important;
            border-bottom: 1px solid #6D9C52;
        }
        
        .content-body ul, .content-body ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .content-body li {
            margin-bottom: 5px;
        }
        
        .content-body code {
            background: rgba(13, 15, 21, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .content-body pre {
            background: rgba(13, 15, 21, 0.8);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .content-body blockquote {
            border-left: 4px solid #5D8C42;
            padding-left: 15px;
            margin: 15px 0;
            color: var(--text-gray);
            font-style: italic;
        }
        
        .edit-section {
            background: rgba(42, 46, 58, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid transparent;
            border-image: var(--primary);
            border-image-slice: 1;
        }
        
        .edit-textarea {
            width: 100%;
            height: 300px;
            background: rgba(13, 15, 21, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: var(--text);
            padding: 15px;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
            font-family: 'Arial', sans-serif;
        }
        
        .edit-textarea:focus {
            outline: none;
            border-color: #5D8C42;
            box-shadow: 0 0 10px rgba(93, 140, 66, 0.3);
        }
        
        .edit-button {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .edit-button:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        /* Navigation Buttons */
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-btn {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        
        .nav-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-3px);
        }
        
        /* Back Button */
        .back-button {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .back-button:hover {
            background: var(--primary-hover);
            transform: translateX(-3px) translateY(-2px);
        }
        
        /* RP Tasks Section */
        .rp-tasks {
            margin-top: 50px;
        }
        
        /* Footer */
        .footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 20px;
            color: var(--text-gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(26, 29, 37, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .footer p {
            margin: 0;
            opacity: 0.8;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                left: -250px;
            }
            
            .sidebar.active ~ .menu-toggle {
                left: 210px;
            }
            
            .dropdown-content {
                position: static;
                display: none;
                background: rgba(42, 46, 58, 0.8);
                margin-top: 5px;
                border-radius: 6px;
            }
            
            .dropdown.active .dropdown-content {
                display: block;
            }
            
            .quick-cards {
                grid-template-columns: 1fr;
            }
            
            .chapters-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                grid-template-columns: 1fr;
            }
            
            .user-panel {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #5D8C42;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            text-align: center;
            color: var(--text-gray);
            margin-top: 10px;
        }

        /* –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .simple-hint {
            background: rgba(13, 15, 21, 0.6);
            padding: 8px;
            border-radius: 6px;
            margin-top: 5px;
            border-left: 3px solid #5D8C42;
            font-size: 12px;
        }
        
        .simple-hint strong {
            color: #5D8C42;
        }
        
        .simple-hint code {
            background: rgba(42, 46, 58, 0.8);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .button-row .auth-button {
            margin-top: 0;
            flex: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ */
        .search-container {
            margin: 20px 0;
        }

        .search-result-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .search-result-card:hover {
            background: var(--card-gradient-hover) !important;
            transform: translateY(-2px) !important;
            border-color: rgba(255,255,255,0.2) !important;
        }

        mark {
            background: #5D8C42 !important;
            color: white !important;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .media-upload-section {
            background: rgba(42, 46, 58, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #5D8C42;
        }
        
        .media-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .media-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(13, 15, 21, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .media-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        
        .media-item .file-icon {
            width: 100%;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: var(--text-gray);
        }
        
        .media-item .file-name {
            padding: 8px;
            font-size: 12px;
            color: var(--text);
            word-break: break-all;
            text-align: center;
        }
        
        .media-item .delete-media {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .media-item:hover .delete-media {
            opacity: 1;
        }
        
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin: 15px 0;
        }
        
        .upload-area:hover {
            border-color: #5D8C42;
            background: rgba(93, 140, 66, 0.1);
        }
        
        .upload-area.dragover {
            border-color: #5D8C42;
            background: rgba(93, 140, 66, 0.2);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
            color: var(--text-gray);
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .media-gallery-item {
            border-radius: 8px;
            overflow: hidden;
            background: rgba(13, 15, 21, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .media-gallery-item:hover {
            transform: translateY(-2px);
            border-color: rgba(255,255,255,0.2);
        }
        
        .media-gallery-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .media-gallery-item .file-info {
            padding: 10px;
            font-size: 12px;
            color: var(--text-gray);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ–¥–∏–∞ */
        .media-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 3000;
            backdrop-filter: blur(10px);
        }
        
        .media-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .media-modal-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .media-modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
        }
        
        .close-media-modal {
            position: absolute;
            top: -40px;
            right: 0;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .media-download-btn {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ–¥–∏–∞ -->
    <div class="media-modal">
        <div class="media-modal-content">
            <button class="close-media-modal" onclick="closeMediaModal()">‚úï</button>
            <img id="modal-media-image" src="" alt="">
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div class="auth-modal">
        <div class="auth-content">
            <h3 style="text-align: center; margin-bottom: 20px;">–í—Ö—ñ–¥ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            
            <div class="auth-form active" id="login-form">
                <div class="form-group">
                    <label>–õ–æ–≥—ñ–Ω:</label>
                    <input type="text" id="login-username" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="login-password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="auth-button" onclick="login()">–£–≤—ñ–π—Ç–∏</button>
                <div class="auth-message" id="login-message"></div>
            </div>
        </div>
    </div>

    <!-- Card Creation Modal - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø -->
    <div class="card-modal">
        <div class="card-modal-content">
            <h3 style="text-align: center; margin-bottom: 20px;" id="card-modal-title">–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —ñ—Å–ø–∏—Ç</h3>
            
            <div class="form-group">
                <label>ID –∫–∞—Ä—Ç–∫–∏:</label>
                <input type="text" id="new-card-id" placeholder="new-topic">
                <div class="simple-hint">
                    <strong>üìã ID –ø—Ä–∞–≤–∏–ª–∞:</strong> –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏, –¥–µ—Ñ—ñ—Å–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: <code>new-topic</code>
                </div>
            </div>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞ –∫–∞—Ä—Ç–∫–∏:</label>
                <input type="text" id="new-card-title" placeholder="–ù–æ–≤–∞ —Ç–µ–º–∞">
            </div>
            
            <div class="form-group">
                <label>–ö–æ–Ω—Ç–µ–Ω—Ç:</label>
                <textarea class="edit-textarea" id="new-card-content" placeholder="–û–ø–∏—à—ñ—Ç—å —Ç–µ–º—É..." style="height: 150px;"># –ù–æ–≤–∏–π —ñ—Å–ø–∏—Ç\n\n–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ</textarea>
            </div>
            
            <div class="button-row">
                <button class="auth-button" onclick="createNewCard()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                <button class="auth-button" onclick="closeCardModal()" style="background: var(--error);">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-overlay"></div>
    <div class="admin-panel">
        <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
        
        <div class="users-info">
            <p><strong>–ü–æ—Ç–æ—á–Ω–∏–π –∞–¥–º—ñ–Ω:</strong> <span id="current-admin">admin</span></p>
        </div>

        <div class="form-group">
            <label>–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
            <input type="text" id="new-username" placeholder="–õ–æ–≥—ñ–Ω –Ω–æ–≤–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
            <input type="password" id="new-password" placeholder="–ü–∞—Ä–æ–ª—å –Ω–æ–≤–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞" style="margin-top: 10px;">
            <button class="auth-button" onclick="addUser()" style="margin-top: 10px;">–î–æ–¥–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        </div>
        
        <div class="logs-section">
            <h4>–û—Å—Ç–∞–Ω–Ω—ñ –¥—ñ—ó –≤ —Å–∏—Å—Ç–µ–º—ñ:</h4>
            <div class="logs-list" id="logs-list">
                <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <button class="auth-button" onclick="closeAdminPanel()">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>

    <!-- User Panel -->
    <div class="user-panel">
        <button class="login-button" onclick="showLoginModal()" id="login-btn">–í—Ö—ñ–¥ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        <div class="user-info" id="user-info" style="display: none;"></div>
        <button class="admin-button" onclick="showAdminPanel()" id="admin-btn" style="display: none;">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</button>
        <button class="admin-button" onclick="logout()" id="logout-btn" style="display: none;">–í–∏–π—Ç–∏</button>
    </div>
    
    <!-- Sidebar Menu -->
    <button class="menu-toggle">‚ò∞ –ú–µ–Ω—é</button>
    
    <div class="sidebar">
        <h2>Military Academy</h2>
        <ul class="sidebar-nav">
            <li><a href="#" class="nav-link active" data-page="home">
                <span class="nav-icon">üè†</span>–ì–æ–ª–æ–≤–Ω–∞
            </a></li>
            <li class="dropdown">
                <a href="#" class="nav-link" data-page="exams">
                    <span class="nav-icon">‚ö°</span>–Ü—Å–ø–∏—Ç–∏
                </a>
                <div class="dropdown-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </li>
            <li class="dropdown">
                <a href="#" class="nav-link" data-page="lectures">
                    <span class="nav-icon">üìö</span>–õ–µ–∫—Ü—ñ—ó
                </a>
                <div class="dropdown-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </li>
            <li class="dropdown">
                <a href="#" class="nav-link" data-page="training">
                    <span class="nav-icon">üí™</span>–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
                </a>
                <div class="dropdown-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </li>
            <li class="dropdown">
                <a href="#" class="nav-link" data-page="instructions">
                    <span class="nav-icon">üìã</span>–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂—ñ
                </a>
                <div class="dropdown-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </li>
            <li class="dropdown">
                <a href="#" class="nav-link" data-page="tasks">
                    <span class="nav-icon">üéØ</span>–†–ü –ó–∞–≤–¥–∞–Ω–Ω—è
                </a>
                <div class="dropdown-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </li>
        </ul>
        
        <div class="discord-link">
            <a href="https://discord.com/users/808726131020791869" target="_blank">
                <span class="nav-icon">üí°</span>–î–ª—è –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É —Ç–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π: Discord
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Home Page -->
        <div id="home" class="page active">
            <!-- –ü–û–ò–°–ö –î–û–ë–ê–í–õ–ï–ù –ó–î–ï–°–¨ -->
            <div class="search-container">
                <div style="position: relative; max-width: 500px; margin: 0 auto;">
                    <input type="text" id="global-search" placeholder="üîç –ü–æ—à—É–∫ –ø–æ –≤—Å—ñ–π –∞–∫–∞–¥–µ–º—ñ—ó..." 
                           style="width: 100%; padding: 12px 45px 12px 15px; background: rgba(13,15,21,0.8); 
                                  border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; 
                                  color: var(--text); font-size: 14px;">
                    <button onclick="clearSearch()" style="position: absolute; right: 15px; top: 50%; 
                            transform: translateY(-50%); background: none; border: none; color: var(--text-gray); 
                            cursor: pointer;">‚úï</button>
                </div>
                <div id="search-results" style="display: none; margin-top: 20px;"></div>
            </div>

            <div class="welcome-section">
                <h1>–®–∞–Ω–æ–≤–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏!</h1>
                <p>–¶–µ–π —Å–∞–π—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –¥–æ–ø–æ–º–æ–≥–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º Military Academy —É –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ —Å–ª—É–∂–±–æ–≤–∏—Ö –æ–±–æ–≤'—è–∑–∫—ñ–≤, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ñ –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö –∑–∞–Ω—è—Ç—å —Ç–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤—Ü—ñ –∫—É—Ä—Å–∞–Ω—Ç—ñ–≤.</p>
            </div>

            <div class="quick-cards">
                <div class="card" data-page="exams">
                    <h3>–Ü—Å–ø–∏—Ç–∏</h3>
                </div>
                <div class="card" data-page="lectures">
                    <h3>–õ–µ–∫—Ü—ñ—ó</h3>
                </div>
                <div class="card" data-page="training">
                    <h3>–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</h3>
                </div>
                <div class="card" data-page="instructions">
                    <h3>–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂—ñ</h3>
                </div>
            </div>

            <div class="rp-tasks">
                <div class="card" data-page="tasks">
                    <h3>–†–ü –ó–∞–≤–¥–∞–Ω–Ω—è</h3>
                </div>
            </div>
        </div>

        <!-- Exams Page -->
        <div id="exams" class="page">
            <button class="back-button" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó</button>
            <div class="section-header">
                <h2>–Ü—Å–ø–∏—Ç–∏</h2>
                <button class="add-card-btn" onclick="showCardModal('exam')">
                    ‚ûï –î–æ–¥–∞—Ç–∏ —ñ—Å–ø–∏—Ç
                </button>
            </div>
            <div class="chapters-grid" id="exams-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏c–ø–∏—Ç–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- Lectures Page -->
        <div id="lectures" class="page">
            <button class="back-button" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó</button>
            <div class="section-header">
                <h2>–õ–µ–∫—Ü—ñ—ó</h2>
                <button class="add-card-btn" onclick="showCardModal('lecture')">
                    ‚ûï –î–æ–¥–∞—Ç–∏ –ª–µ–∫—Ü—ñ—é
                </button>
            </div>
            <div class="chapters-grid" id="lectures-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ª–µ–∫—Ü–∏–π –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- Training Page -->
        <div id="training" class="page">
            <button class="back-button" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó</button>
            <div class="section-header">
                <h2>–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</h2>
                <button class="add-card-btn" onclick="showCardModal('training')">
                    ‚ûï –î–æ–¥–∞—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
                </button>
            </div>
            <div class="chapters-grid" id="training-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- Instructions Page -->
        <div id="instructions" class="page">
            <button class="back-button" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó</button>
            <div class="section-header">
                <h2>–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂—ñ</h2>
                <button class="add-card-btn" onclick="showCardModal('instruction')">
                    ‚ûï –î–æ–¥–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂
                </button>
            </div>
            <div class="chapters-grid" id="instructions-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- Tasks Page -->
        <div id="tasks" class="page">
            <button class="back-button" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó</button>
            <div class="section-header">
                <h2>–†–ü –ó–∞–≤–¥–∞–Ω–Ω—è</h2>
                <button class="add-card-btn" onclick="showCardModal('task')">
                    ‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
                </button>
            </div>
            <div class="chapters-grid" id="tasks-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞–Ω–∏–π –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- Content Pages Container -->
        <div id="content-pages"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Ukraine GTA 5 | Army. –°–∞–π—Ç —Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω—ñ Danil Perets.</p>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBJU9vxpn6bMQrCIzu4ixuYNAg_TjReNCY",
            authDomain: "us-army-ukraine-gta5.firebaseapp.com",
            databaseURL: "https://us-army-ukraine-gta5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "us-army-ukraine-gta5",
            storageBucket: "us-army-ukraine-gta5.firebasestorage.app",
            messagingSenderId: "544783269993",
            appId: "1:544783269993:web:55377448115351af7680c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // User management system
        let currentUser = null;
        let contentStorage = {};
        let mediaStorage = {};
        let systemLogs = [];
        let currentCardType = '';
        let isInitialLoad = true;
        let currentContentId = '';

        // Initialize data
        function initializeData() {
            // Check if user is logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = {
                        username: user.email.split('@')[0],
                        isAdmin: true,
                        uid: user.uid
                    };
                    updateUserPanel();
                    loadContentFromFirebase();
                    loadMediaFromFirebase();
                    loadLogsFromFirebase();
                    
                    // Add login log
                    addSystemLog('user_login', `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${currentUser.username} —É–≤—ñ–π—à–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É`);
                } else {
                    currentUser = null;
                    updateUserPanel();
                    loadContentFromFirebase();
                    loadMediaFromFirebase();
                }
            });

            // Initialize content listeners
            initContentListeners();
            initMediaListeners();
            initLogsListeners();
            
            // Initialize content links
            initContentLinks();
            
            // Initialize search
            initSearch();
        }

        // –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ –∏–∑ Firebase
        function loadMediaFromFirebase() {
            database.ref('media').once('value')
                .then((snapshot) => {
                    const media = snapshot.val();
                    if (media) {
                        mediaStorage = media;
                    }
                })
                .catch((error) => {
                    console.error('Error loading media:', error);
                });
        }

        // –ù–û–í–û–ï: –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–¥–∏–∞
        function initMediaListeners() {
            database.ref('media').on('value', (snapshot) => {
                const media = snapshot.val();
                if (media && JSON.stringify(media) !== JSON.stringify(mediaStorage)) {
                    mediaStorage = media;
                    if (currentContentId) {
                        updateMediaDisplay(currentContentId);
                    }
                }
            });
        }

        // –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞ –≤ Firebase
        function saveMediaToFirebase() {
            database.ref('media').set(mediaStorage)
                .then(() => {
                    console.log('Media saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving media:', error);
                });
        }

        // –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏ –º–µ–¥–∏–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function showMediaSection(contentId) {
            return `
                <div class="media-upload-section">
                    <h4>üìé –ú–µ–¥—ñ–∞-—Ñ–∞–π–ª–∏</h4>
                    <p>–î–æ–¥–∞–π—Ç–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —Å—Ö–µ–º–∏ –∞–±–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –¥–æ —Ü—å–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É</p>
                    
                    <div class="upload-area" id="upload-area-${contentId}" 
                         onclick="document.getElementById('file-input-${contentId}').click()">
                        <div class="upload-icon">üìÅ</div>
                        <p>–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª–∏ —Å—é–¥–∏ –∞–±–æ –∫–ª—ñ–∫–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É</p>
                        <small>–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è: JPG, PNG, PDF, DOC</small>
                    </div>
                    
                    <input type="file" id="file-input-${contentId}" 
                           style="display: none;" multiple 
                           onchange="handleFileUpload('${contentId}', this.files)">
                    
                    <div class="media-preview" id="media-preview-${contentId}">
                        ${renderMediaPreview(contentId)}
                    </div>
                </div>
            `;
        }

        // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–≤—å—é –º–µ–¥–∏–∞
        function renderMediaPreview(contentId) {
            if (!mediaStorage[contentId] || Object.keys(mediaStorage[contentId]).length === 0) {
                return '<p style="color: var(--text-gray); text-align: center;">–§–∞–π–ª—ñ–≤ —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ</p>';
            }
            
            return Object.keys(mediaStorage[contentId]).map(mediaId => {
                const media = mediaStorage[contentId][mediaId];
                const isImage = media.type.startsWith('image/');
                
                return `
                    <div class="media-item">
                        ${isImage ? 
                            `<img src="${media.url}" alt="${media.name}" onclick="viewMedia('${media.url}')">` :
                            `<div class="file-icon">üìÑ</div>`
                        }
                        <div class="file-name">${media.name}</div>
                        ${currentUser ? `
                            <button class="delete-media" onclick="deleteMedia('${contentId}', '${mediaId}')">√ó</button>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function handleFileUpload(contentId, files) {
            if (!currentUser) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä');
                return;
            }
            
            for (let file of files) {
                uploadFile(contentId, file);
            }
        }

        // –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ Firebase Storage
        function uploadFile(contentId, file) {
            const fileId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            const filePath = `media/${contentId}/${fileId}_${file.name}`;
            const storageRef = storage.ref(filePath);
            
            const uploadTask = storageRef.put(file);
            
            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done');
                },
                (error) => {
                    console.error('Upload error:', error);
                    alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É: ' + error.message);
                },
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        if (!mediaStorage[contentId]) {
                            mediaStorage[contentId] = {};
                        }
                        
                        mediaStorage[contentId][fileId] = {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            url: downloadURL,
                            uploadedBy: currentUser.username,
                            uploadedAt: new Date().toISOString()
                        };
                        
                        saveMediaToFirebase();
                        updateMediaDisplay(contentId);
                        addSystemLog('media_uploaded', `–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Ñ–∞–π–ª: ${file.name} –¥–ª—è ${getPageTitle(contentId)}`);
                        console.log('File available at', downloadURL);
                    });
                }
            );
        }

        // –ù–û–í–û–ï: –£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞
        function deleteMedia(contentId, mediaId) {
            if (!currentUser) return;
            
            if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª?')) return;
            
            const media = mediaStorage[contentId][mediaId];
            const filePath = `media/${contentId}/${mediaId}_${media.name}`;
            
            storage.ref(filePath).delete().then(() => {
                delete mediaStorage[contentId][mediaId];
                
                if (Object.keys(mediaStorage[contentId]).length === 0) {
                    delete mediaStorage[contentId];
                }
                
                saveMediaToFirebase();
                updateMediaDisplay(contentId);
                addSystemLog('media_deleted', `–í–∏–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª: ${media.name}`);
                
            }).catch((error) => {
                console.error('Error deleting file:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—É');
            });
        }

        // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–¥–∏–∞
        function updateMediaDisplay(contentId) {
            const preview = document.getElementById(`media-preview-${contentId}`);
            if (preview) {
                preview.innerHTML = renderMediaPreview(contentId);
            }
        }

        // –ù–û–í–û–ï: –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–∏–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function viewMedia(url) {
            document.getElementById('modal-media-image').src = url;
            document.querySelector('.media-modal').classList.add('active');
        }

        // –ù–û–í–û–ï: –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–µ–¥–∏–∞
        function closeMediaModal() {
            document.querySelector('.media-modal').classList.remove('active');
        }

        // –ù–û–í–û–ï: Drag and Drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
        function initDragAndDrop(contentId) {
            const uploadArea = document.getElementById(`upload-area-${contentId}`);
            const fileInput = document.getElementById(`file-input-${contentId}`);
            
            if (!uploadArea) return;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFileUpload(contentId, files);
            }
        }

        // –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä –≥–∞–ª–µ—Ä–µ–∏ –º–µ–¥–∏–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function renderMediaGallery(contentId) {
            if (!mediaStorage[contentId] || Object.keys(mediaStorage[contentId]).length === 0) {
                return '';
            }
            
            const mediaItems = Object.keys(mediaStorage[contentId]).map(mediaId => {
                const media = mediaStorage[contentId][mediaId];
                const isImage = media.type.startsWith('image/');
                
                return `
                    <div class="media-gallery-item">
                        ${isImage ? 
                            `<img src="${media.url}" alt="${media.name}" onclick="viewMedia('${media.url}')" style="cursor: pointer;">` :
                            `<div class="file-icon">üìÑ</div>`
                        }
                        <div class="file-info">
                            <div><strong>${media.name}</strong></div>
                            <div>${formatFileSize(media.size)}</div>
                            <button class="media-download-btn" onclick="downloadFile('${media.url}', '${media.name}')">
                                ‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="media-section">
                    <h3>üìé –ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏</h3>
                    <div class="media-gallery">
                        ${mediaItems}
                    </div>
                </div>
            `;
        }

        // –ù–û–í–û–ï: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // –ù–û–í–û–ï: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
        }

        // –ü–û–ò–°–ö - –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø
        function initSearch() {
            document.getElementById('global-search').addEventListener('input', function(e) {
                performSearch(e.target.value);
            });
        }

        function performSearch(query) {
            if (query.length < 2) {
                document.getElementById('search-results').style.display = 'none';
                return;
            }
            
            const results = [];
            const searchTerm = query.toLowerCase();
            
            Object.keys(contentStorage).forEach(cardId => {
                const content = contentStorage[cardId].toLowerCase();
                const title = getPageTitle(cardId).toLowerCase();
                
                if (title.includes(searchTerm) || content.includes(searchTerm)) {
                    results.push({
                        id: cardId,
                        title: getPageTitle(cardId),
                        type: getCardType(cardId),
                        preview: getContentPreview(contentStorage[cardId], searchTerm)
                    });
                }
            });
            
            displaySearchResults(results, query);
        }

        function getCardType(cardId) {
            if (cardId.startsWith('exam-')) return '–Ü—Å–ø–∏—Ç';
            if (cardId.startsWith('lecture-')) return '–õ–µ–∫—Ü—ñ—è';
            if (cardId.startsWith('training-')) return '–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è';
            if (cardId.startsWith('instruction-')) return '–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂';
            if (cardId.startsWith('task-')) return '–†–ü –ó–∞–≤–¥–∞–Ω–Ω—è';
            return '–Ü–Ω—à–µ';
        }

        function getContentPreview(content, searchTerm) {
            const index = content.toLowerCase().indexOf(searchTerm);
            if (index === -1) return content.substring(0, 150) + '...';
            
            const start = Math.max(0, index - 50);
            const end = Math.min(content.length, index + 100);
            let preview = content.substring(start, end);
            
            preview = preview.replace(new RegExp(searchTerm, 'gi'), match => 
                `<mark>${match}</mark>`
            );
            
            return (start > 0 ? '...' : '') + preview + (end < content.length ? '...' : '');
        }

        function displaySearchResults(results, query) {
            const container = document.getElementById('search-results');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="no-results" style="text-align: center; color: var(--text-gray); padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üîç</div>
                        <h3>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="search-header" style="margin-bottom: 20px;">
                        <h3 style="color: var(--text);">–ó–Ω–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –¥–ª—è "${query}"</h3>
                    </div>
                    <div class="results-grid">
                        ${results.map(result => `
                            <div class="search-result-card" onclick="openSearchResult('${result.id}')" 
                                 style="background: var(--card-gradient); border: 1px solid rgba(255,255,255,0.1); 
                                        border-radius: 8px; padding: 20px; margin-bottom: 15px; cursor: pointer;
                                        transition: all 0.3s ease;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                    <h4 style="color: var(--text); margin: 0; flex: 1;">${result.title}</h4>
                                    <span style="background: #5D8C42; color: white; padding: 4px 8px; border-radius: 12px; 
                                                 font-size: 12px; white-space: nowrap; margin-left: 10px;">
                                        ${result.type}
                                    </span>
                                </div>
                                <div style="color: var(--text-gray); font-size: 14px; line-height: 1.4;">
                                    ${result.preview}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                document.querySelectorAll('.search-result-card').forEach(card => {
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px)';
                        this.style.borderColor = 'rgba(255,255,255,0.2)';
                    });
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.borderColor = 'rgba(255,255,255,0.1)';
                    });
                });
            }
            
            container.style.display = 'block';
        }

        function openSearchResult(cardId) {
            const title = getPageTitle(cardId);
            showContentPage(cardId, title);
            document.getElementById('global-search').value = '';
            document.getElementById('search-results').style.display = 'none';
        }

        function clearSearch() {
            document.getElementById('global-search').value = '';
            document.getElementById('search-results').style.display = 'none';
        }

        // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –º–µ–¥–∏–∞
        function showContentPage(contentId, title) {
            pages.forEach(page => page.classList.remove('active'));
            contentPages.innerHTML = '';
            
            const parentPage = getParentPage(contentId);
            const navButtons = getNavigationButtons(contentId, parentPage);
            const canEdit = currentUser && currentUser.isAdmin;
            currentContentId = contentId;
            
            contentPages.innerHTML = `
                <div class="page active">
                    <button class="back-button" onclick="showPage('${parentPage}')">‚Üê –ù–∞–∑–∞–¥</button>
                    <div class="content-page">
                        <div class="content-header">
                            <h2>${title}</h2>
                        </div>
                        <div class="content-body" id="content-${contentId}">
                            ${renderMarkdown(contentStorage[contentId] || '# –ö–æ–Ω—Ç–µ–Ω—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ')}
                        </div>
                        
                        <!-- –ù–û–í–û–ï: –ì–∞–ª–µ—Ä–µ—è –º–µ–¥–∏–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
                        ${renderMediaGallery(contentId)}
                        
                        ${canEdit ? `
                        <div class="edit-section">
                            <h4>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç:</h4>
                            <textarea class="edit-textarea" id="edit-${contentId}">${contentStorage[contentId] || ''}</textarea>
                            <button class="edit-button" onclick="saveContentItem('${contentId}')">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                            <p><small>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É</small></p>
                            
                            <!-- –ù–û–í–û–ï: –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞ -->
                            ${showMediaSection(contentId)}
                        </div>
                        ` : ''}
                        ${navButtons}
                    </div>
                </div>
            `;
            
            if (canEdit) {
                setTimeout(() => initDragAndDrop(contentId), 100);
            }
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === parentPage) {
                    link.classList.add('active');
                }
            });
        }

        // Add system log
        function addSystemLog(action, details = '') {
            if (!currentUser) return;
            
            const logEntry = {
                timestamp: new Date().toISOString(),
                user: currentUser.username,
                userId: currentUser.uid,
                action: action,
                details: details
            };
            
            console.log('System log:', logEntry);
            
            database.ref('logs').push(logEntry)
                .then(() => {
                    console.log('Log saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving log:', error);
                });
        }

        // Load logs from Firebase
        function loadLogsFromFirebase() {
            database.ref('logs').orderByChild('timestamp').limitToLast(20).once('value')
                .then((snapshot) => {
                    const logs = [];
                    snapshot.forEach((childSnapshot) => {
                        logs.push(childSnapshot.val());
                    });
                    systemLogs = logs.reverse();
                    updateLogsDisplay();
                })
                .catch((error) => {
                    console.error('Error loading logs:', error);
                });
        }

        // Listen for new logs
        function initLogsListeners() {
            database.ref('logs').limitToLast(1).on('child_added', (snapshot) => {
                const newLog = snapshot.val();
                systemLogs.unshift(newLog);
                if (systemLogs.length > 20) {
                    systemLogs.pop();
                }
                updateLogsDisplay();
            });
        }

        // Update logs display
        function updateLogsDisplay() {
            const logsList = document.getElementById('logs-list');
            if (!logsList) return;
            
            logsList.innerHTML = '';
            
            systemLogs.forEach(log => {
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                
                const time = new Date(log.timestamp).toLocaleString('uk-UA');
                const actionText = getActionText(log.action);
                
                logItem.innerHTML = `
                    <div>
                        <span class="log-time">${time}</span>
                        <span class="log-user">${log.user}</span>
                        <span>${actionText}</span>
                        ${log.details ? `<br><small>${log.details}</small>` : ''}
                    </div>
                `;
                
                logsList.appendChild(logItem);
            });
        }

        // Get readable action text
        function getActionText(action) {
            const actions = {
                'user_login': '—É–≤—ñ–π—à–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É',
                'user_logout': '–≤–∏–π—à–æ–≤ –∑ —Å–∏—Å—Ç–µ–º–∏',
                'content_edit': '–≤—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞–≤ –∫–æ–Ω—Ç–µ–Ω—Ç',
                'user_created': '—Å—Ç–≤–æ—Ä–∏–≤ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞',
                'content_saved': '–∑–±–µ—Ä–µ–≥–ª–∏ –∑–º—ñ–Ω–∏ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç—ñ',
                'card_created': '—Å—Ç–≤–æ—Ä–∏–≤ –Ω–æ–≤—É –∫–∞—Ä—Ç–∫—É',
                'card_deleted': '–≤–∏–¥–∞–ª–∏–≤ –∫–∞—Ä—Ç–∫—É',
                'media_uploaded': '–∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤ –º–µ–¥—ñ–∞-—Ñ–∞–π–ª',
                'media_deleted': '–≤–∏–¥–∞–ª–∏–≤ –º–µ–¥—ñ–∞-—Ñ–∞–π–ª'
            };
            
            return actions[action] || action;
        }

        // Load content from Firebase
        function loadContentFromFirebase() {
            showLoading('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É...');
            
            database.ref('content').once('value')
                .then((snapshot) => {
                    const content = snapshot.val();
                    if (content) {
                        contentStorage = content;
                    } else {
                        initializeDefaultContent();
                    }
                    updateAllPages();
                    hideLoading();
                    isInitialLoad = false;
                })
                .catch((error) => {
                    console.error('Error loading content:', error);
                    hideLoading();
                    loadContentFromLocalStorage();
                    isInitialLoad = false;
                });
        }

        // Update all pages with current content
        function updateAllPages() {
            updatePage('exams', 'exam');
            updatePage('lectures', 'lecture');
            updatePage('training', 'training');
            updatePage('instructions', 'instruction');
            updatePage('tasks', 'task');
            updateSidebarDropdowns();
        }

        // Update specific page with cards
        function updatePage(pageId, prefix) {
            const grid = document.getElementById(`${pageId}-grid`);
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const pageCards = Object.keys(contentStorage)
                .filter(key => key.startsWith(prefix))
                .sort();
            
            pageCards.forEach(cardId => {
                const cardTitle = getPageTitle(cardId);
                const cardElement = document.createElement('div');
                cardElement.className = 'chapter-card';
                cardElement.innerHTML = `
                    <h4>${cardTitle}</h4>
                    ${currentUser ? `<button class="delete-card-btn" onclick="deleteCard('${cardId}', event)">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>` : ''}
                `;
                cardElement.onclick = () => showContentPage(cardId, cardTitle);
                grid.appendChild(cardElement);
            });
        }

        // Update sidebar dropdowns
        function updateSidebarDropdowns() {
            const sections = {
                'exams': 'exam',
                'lectures': 'lecture', 
                'training': 'training',
                'instructions': 'instruction',
                'tasks': 'task'
            };
            
            Object.keys(sections).forEach(section => {
                const dropdown = document.querySelector(`[data-page="${section}"] + .dropdown-content`);
                if (dropdown) {
                    dropdown.innerHTML = '';
                    
                    const sectionCards = Object.keys(contentStorage)
                        .filter(key => key.startsWith(sections[section]))
                        .sort();
                    
                    sectionCards.forEach(cardId => {
                        const link = document.createElement('a');
                        link.href = '#';
                        link.textContent = getPageTitle(cardId);
                        link.onclick = () => showContentPage(cardId, getPageTitle(cardId));
                        dropdown.appendChild(link);
                    });
                }
            });
        }

        // Show card creation modal - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        function showCardModal(cardType) {
            if (!currentUser) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä');
                return;
            }
            
            currentCardType = cardType;
            const modalTitle = document.getElementById('card-modal-title');
            const titles = {
                'exam': '–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —ñ—Å–ø–∏—Ç',
                'lecture': '–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –ª–µ–∫—Ü—ñ—é',
                'training': '–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è',
                'instruction': '–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂',
                'task': '–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è'
            };
            
            modalTitle.textContent = titles[cardType] || '–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–∞—Ä—Ç–∫—É';
            document.getElementById('new-card-id').value = '';
            document.getElementById('new-card-title').value = '';
            
            const contentTitles = {
                'exam': '–Ω–æ–≤–∏–π —ñ—Å–ø–∏—Ç',
                'lecture': '–Ω–æ–≤–∞ –ª–µ–∫—Ü—ñ—è',
                'training': '–Ω–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è',
                'instruction': '–Ω–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂',
                'task': '–Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è'
            };
            
            document.getElementById('new-card-content').value = `# –ù${contentTitles[cardType] || '–æ–≤–∞ —Ç–µ–º–∞'}\n\n–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ`;
            
            document.querySelector('.card-modal').classList.add('active');
        }

        // Close card modal
        function closeCardModal() {
            document.querySelector('.card-modal').classList.remove('active');
        }

        // Create new card - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        function createNewCard() {
            if (!currentUser) return;
            
            const cardId = document.getElementById('new-card-id').value.trim();
            const cardTitle = document.getElementById('new-card-title').value.trim();
            const cardContent = document.getElementById('new-card-content').value.trim();
            
            if (!cardId || !cardTitle) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å ID —Ç–∞ –Ω–∞–∑–≤—É –∫–∞—Ä—Ç–∫–∏');
                return;
            }
            
            if (!/^[a-zA-Z0-9-]+$/.test(cardId)) {
                alert('ID –∫–∞—Ä—Ç–∫–∏ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏ —Ç–∞ –¥–µ—Ñ—ñ—Å–∏');
                return;
            }
            
            const fullCardId = `${currentCardType}-${cardId}`;
            
            if (contentStorage[fullCardId]) {
                alert('–ö–∞—Ä—Ç–∫–∞ –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î! –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —ñ–Ω—à–∏–π ID.');
                return;
            }
            
            const finalContent = cardContent.replace(/^#\s+.+$/m, `# ${cardTitle}`);
            
            contentStorage[fullCardId] = finalContent;
            
            saveContentToFirebase();
            
            addSystemLog('card_created', `–°—Ç–≤–æ—Ä–µ–Ω–æ –∫–∞—Ä—Ç–∫—É: ${cardTitle} (${fullCardId})`);
            
            updateAllPages();
            closeCardModal();
            
            alert(`–ö–∞—Ä—Ç–∫–∞ "${cardTitle}" —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞!`);
        }

        // Delete card
        function deleteCard(cardId, event) {
            if (!currentUser) return;
            
            event.stopPropagation();
            
            const cardTitle = getPageTitle(cardId);
            
            if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É "${cardTitle}"? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏!`)) {
                return;
            }
            
            delete contentStorage[cardId];
            
            saveContentToFirebase();
            
            addSystemLog('card_deleted', `–í–∏–¥–∞–ª–µ–Ω–æ –∫–∞—Ä—Ç–∫—É: ${cardTitle} (${cardId})`);
            
            updateAllPages();
            
            alert(`–ö–∞—Ä—Ç–∫–∞ "${cardTitle}" —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞!`);
        }

        // Initialize default content
        function initializeDefaultContent() {
            contentStorage = {
                // Exams
                'exam-prisyaga': '# –Ü—Å–ø–∏—Ç | –ü—Ä–∏—Å—è–≥–∞\n\n## –¢–µ—Å—Ç–æ–≤—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:\n\n1. [Google Docs –∑ –ø–æ–≤–Ω–∏–º URL](https://docs.google.com/document/d/1JjF-zAGY2vZZ3pZRI09f174kliGl_hiJzIhwt1Nit-c/edit?usp=sharing)\n\n2. [Google Docs –±–µ–∑ https](docs.google.com/document/d/1JjF-zAGY2vZZ3pZRI09f174kliGl_hiJzIhwt1Nit-c/edit?usp=sharing)\n\n3. [–ó–≤–∏—á–∞–π–Ω–∏–π Google](https://www.google.com)\n\n## –í–∞—à–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:\n–°—Ü–µ–Ω–∞—Ä—ñ—ó –≤ [Google Docs](https://docs.google.com/document/d/1JjF-zAGY2vZZ3pZRI09f174kliGl_hiJzIhwt1Nit-c/edit?usp=sharing)',
                'exam-stroyoviy': '# –Ü—Å–ø–∏—Ç | –°—Ç—Ä–æ–π–æ–≤–∏–π —Å—Ç–∞—Ç—É—Ç\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*\n\n## –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:\n[–ü–æ—Å–∏–ª–∞–Ω–Ω—è 1](https://example.com)\n[–ü–æ—Å–∏–ª–∞–Ω–Ω—è 2](https://example.org)',
                'exam-vnutrishniy': '# –Ü—Å–ø–∏—Ç | –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞—Ç—É—Ç\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'exam-ten-kody': '# –Ü—Å–ø–∏—Ç | –¢–µ–Ω/–∫–æ–¥–∏ —Ç–∞ –∫–æ–¥–∏\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'exam-zony-fz': '# –Ü—Å–ø–∏—Ç | –Ü—Å–Ω—É—é—á–∏ –∑–æ–Ω–∏ –§–ó\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'exam-dystsyplinarniy': '# –Ü—Å–ø–∏—Ç | –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞—Ä–Ω–∏–π —Å—Ç–∞—Ç—É—Ç\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'exam-subordynatsiya': '# –Ü—Å–ø–∏—Ç | –°—É–±–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                
                // Lectures
                'lecture-stroyoviy': '# –õ–µ–∫—Ü—ñ—è | –°—Ç—Ä–æ–π–æ–≤–∏–π —Å—Ç–∞—Ç—É—Ç\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'lecture-vnutrishniy': '# –õ–µ–∫—Ü—ñ—è | –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞—Ç—É—Ç\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'lecture-ten-kody': '# –õ–µ–∫—Ü—ñ—è | –¢–µ–Ω/–∫–æ–¥–∏ —Ç–∞ –∫–æ–¥–∏\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'lecture-zony-fz': '# –õ–µ–∫—Ü—ñ—è | –Ü—Å–Ω—É—é—á–∏ –∑–æ–Ω–∏ –§–ó\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'lecture-dystsyplinarniy': '# –õ–µ–∫—Ü—ñ—è | –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞—Ä–Ω–∏–π –°—Ç–∞—Ç—É—Ç\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                
                // Training
                'training-physical': '# –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –§—ñ–∑–∏—á–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'training-tactical': '# –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –¢–∞–∫—Ç–∏—á–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'training-medical': '# –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –ú–µ–¥–∏—á–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'training-survival': '# –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –ó–±—ñ—Ä —Ç–∞ —Ä–æ–∑–±–∏—Ä–∞–Ω–Ω—è –∑–±—Ä–æ—ó\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                
                // Instructions
                'instruction-fz': '# –Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –ø–æ –§–ó\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*\n\n## –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞:\n- –ü—Ä–∞–≤–∏–ª–æ 1\n- –ü—Ä–∞–≤–∏–ª–æ 2\n- –ü—Ä–∞–≤–∏–ª–æ 3',
                'instruction-safety': '# –Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∑ —Ç–µ—Ö–Ω—ñ–∫–∏ –±–µ–∑–ø–µ–∫–∏\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'instruction-weapon': '# –Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∑ –ø–æ–≤–æ–¥–∂–µ–Ω–Ω—è –∑—ñ –∑–±—Ä–æ—î—é\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                
                // Tasks
                'task-cleaning-akpp': '# –ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –Ω–∞ –ê–ö–ü–ü-1\\2\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'task-cleaning-towers': '# –ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –Ω–∞ –≤–µ–∂–∞—Ö\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'task-oil-change': '# –ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞ —É –∞–≤—Ç–æ–º–æ–±—ñ–ª—è\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'task-car-cleaning': '# –ß–∏—Å—Ç–∫–∞ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'task-weapon-assembly': '# –ó–±–æ—Ä–∫–∞ —Ç–∞ —Ä–æ–∑–±–æ—Ä–∫–∞ –∑–±—Ä–æ—ó\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*',
                'task-weapon-cleaning': '# –ß–∏—Å—Ç–∫–∞ –∑–±—Ä–æ—ó\n\n*–¢–µ–∫—Å—Ç —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ*'
            };
            
            saveContentToFirebase();
        }

        // Save content to Firebase
        function saveContentToFirebase() {
            database.ref('content').set(contentStorage)
                .then(() => {
                    console.log('Content saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving content:', error);
                    saveContentToLocalStorage();
                });
        }

        // Listen for content changes in real-time
        function initContentListeners() {
            database.ref('content').on('value', (snapshot) => {
                if (isInitialLoad) return;
                
                const content = snapshot.val();
                if (content) {
                    if (JSON.stringify(content) !== JSON.stringify(contentStorage)) {
                        contentStorage = content;
                        updateCurrentPageContent();
                        updateAllPages();
                    }
                }
            });
        }

        // Update current page content if it's a content page
        function updateCurrentPageContent() {
            const contentPages = document.getElementById('content-pages');
            if (contentPages.innerHTML) {
                const activeContent = contentPages.querySelector('.page.active');
                if (activeContent) {
                    const contentId = Object.keys(contentStorage).find(id => 
                        activeContent.innerHTML.includes(`content-${id}`)
                    );
                    if (contentId) {
                        showContentPage(contentId, getPageTitle(contentId));
                    }
                }
            }
        }

        // Get page title from content ID
        function getPageTitle(contentId) {
            const content = contentStorage[contentId];
            if (content) {
                const titleMatch = content.match(/^#\s+(.+)$/m);
                if (titleMatch) {
                    return titleMatch[1];
                }
            }
            
            const titles = {
                'exam-prisyaga': '–Ü—Å–ø–∏—Ç | –ü—Ä–∏—Å—è–≥–∞',
                'exam-stroyoviy': '–Ü—Å–ø–∏—Ç | –°—Ç—Ä–æ–π–æ–≤–∏–π —Å—Ç–∞—Ç—É—Ç',
                'exam-vnutrishniy': '–Ü—Å–ø–∏—Ç | –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞—Ç—É—Ç',
                'exam-ten-kody': '–Ü—Å–ø–∏—Ç | –¢–µ–Ω/–∫–æ–¥–∏ —Ç–∞ –∫–æ–¥–∏',
                'exam-zony-fz': '–Ü—Å–ø–∏—Ç | –Ü—Å–Ω—É—é—á–∏ –∑–æ–Ω–∏ –§–ó',
                'exam-dystsyplinarniy': '–Ü—Å–ø–∏—Ç | –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞—Ä–Ω–∏–π —Å—Ç–∞—Ç—É—Ç',
                'exam-subordynatsiya': '–Ü—Å–ø–∏—Ç | –°—É–±–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è',
                'lecture-stroyoviy': '–õ–µ–∫—Ü—ñ—è | –°—Ç—Ä–æ–π–æ–≤–∏–π —Å—Ç–∞—Ç—É—Ç',
                'lecture-vnutrishniy': '–õ–µ–∫—Ü—ñ—è | –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞—Ç—É—Ç',
                'lecture-ten-kody': '–õ–µ–∫—Ü—ñ—è | –¢–µ–Ω/–∫–æ–¥–∏ —Ç–∞ –∫–æ–¥–∏',
                'lecture-zony-fz': '–õ–µ–∫—Ü—ñ—è | –Ü—Å–Ω—É—é—á–∏ –∑–æ–Ω–∏ –§–ó',
                'lecture-dystsyplinarniy': '–õ–µ–∫—Ü—ñ—è | –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞—Ä–Ω–∏–π –°—Ç–∞—Ç—É—Ç',
                'training-physical': '–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –§—ñ–∑–∏—á–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞',
                'training-tactical': '–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –¢–∞–∫—Ç–∏—á–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è',
                'training-medical': '–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –ú–µ–¥–∏—á–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞',
                'training-survival': '–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è | –ó–±—ñ—Ä —Ç–∞ —Ä–æ–∑–±–∏—Ä–∞–Ω–Ω—è –∑–±—Ä–æ—ó',
                'instruction-fz': '–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –ø–æ –§–ó',
                'instruction-safety': '–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∑ —Ç–µ—Ö–Ω—ñ–∫–∏ –±–µ–∑–ø–µ–∫–∏',
                'instruction-weapon': '–Ü–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∑ –ø–æ–≤–æ–¥–∂–µ–Ω–Ω—è –∑—ñ –∑–±—Ä–æ—î—é',
                'task-cleaning-akpp': '–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –Ω–∞ –ê–ö–ü–ü',
                'task-cleaning-towers': '–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –Ω–∞ –≤–µ–∂–∞—Ö',
                'task-oil-change': '–ó–∞–º—ñ–Ω–∞ –º–∞—Å–ª–∞',
                'task-car-cleaning': '–ß–∏—Å—Ç–∫–∞ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è',
                'task-weapon-assembly': '–ó–±–æ—Ä–∫–∞ –∑–±—Ä–æ—ó',
                'task-weapon-cleaning': '–ß–∏—Å—Ç–∫–∞ –∑–±—Ä–æ—ó'
            };
            
            return titles[contentId] || contentId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Fallback functions for localStorage
        function loadContentFromLocalStorage() {
            const savedContent = localStorage.getItem('military-academy-content');
            if (savedContent) {
                contentStorage = JSON.parse(savedContent);
                updateAllPages();
            } else {
                initializeDefaultContent();
            }
        }

        function saveContentToLocalStorage() {
            localStorage.setItem('military-academy-content', JSON.stringify(contentStorage));
        }

        // Loading functions
        function showLoading(message) {
            const contentPages = document.getElementById('content-pages');
            contentPages.innerHTML = `
                <div class="page active">
                    <div class="content-page" style="text-align: center;">
                        <div class="spinner"></div>
                        <div class="loading-text">${message}</div>
                    </div>
                </div>
            `;
        }

        function hideLoading() {
            const contentPages = document.getElementById('content-pages');
            const loadingSpinner = contentPages.querySelector('.spinner');
            if (loadingSpinner) {
                contentPages.innerHTML = '';
            }
        }

        // Auth functions
        function showLoginModal() {
            document.querySelector('.auth-modal').classList.add('active');
        }

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const message = document.getElementById('login-message');

            if (!username || !password) {
                showMessage(message, '–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è', 'error');
                return;
            }

            const email = `${username}@military-academy.com`;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    showMessage(message, '–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥!', 'success');
                    setTimeout(() => {
                        document.querySelector('.auth-modal').classList.remove('active');
                    }, 1000);
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    showMessage(message, '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å', 'error');
                });
        }

        function logout() {
            if (currentUser) {
                addSystemLog('user_logout', `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${currentUser.username} –≤–∏–π—à–æ–≤ –∑ —Å–∏—Å—Ç–µ–º–∏`);
            }
            
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    updateUserPanel();
                })
                .catch((error) => {
                    console.error('Logout error:', error);
                });
        }

        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = 'auth-message ' + type;
        }

        function updateUserPanel() {
            const loginBtn = document.getElementById('login-btn');
            const userInfo = document.getElementById('user-info');
            const adminBtn = document.getElementById('admin-btn');
            const logoutBtn = document.getElementById('logout-btn');

            if (currentUser) {
                loginBtn.style.display = 'none';
                userInfo.style.display = 'block';
                userInfo.textContent = currentUser.username + ' (–ê–¥–º—ñ–Ω)';
                adminBtn.style.display = 'block';
                logoutBtn.style.display = 'block';
            } else {
                loginBtn.style.display = 'block';
                userInfo.style.display = 'none';
                adminBtn.style.display = 'none';
                logoutBtn.style.display = 'none';
            }
        }

        // Admin functions
        function showAdminPanel() {
            if (!currentUser || !currentUser.isAdmin) return;
            
            document.querySelector('.admin-overlay').classList.add('active');
            document.querySelector('.admin-panel').classList.add('active');
        }

        function closeAdminPanel() {
            document.querySelector('.admin-overlay').classList.remove('active');
            document.querySelector('.admin-panel').classList.remove('active');
        }

        function addUser() {
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;

            if (!username || !password) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
                return;
            }

            const email = `${username}@military-academy.com`;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    alert(`–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä ${username} —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–∏–π`);
                    
                    addSystemLog('user_created', `–°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ${username}`);
                    
                    document.getElementById('new-username').value = '';
                    document.getElementById('new-password').value = '';
                })
                .catch((error) => {
                    console.error('Error creating user:', error);
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ' + error.message);
                });
        }

        // Sidebar toggle
        const menuToggle = document.querySelector('.menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            menuToggle.style.display = 'none';
        });

        // Page navigation
        const navLinks = document.querySelectorAll('.nav-link');
        const cards = document.querySelectorAll('.card');
        const pages = document.querySelectorAll('.page');
        const contentPages = document.getElementById('content-pages');

        // Mobile dropdown handling
        const dropdowns = document.querySelectorAll('.dropdown');
        if (window.innerWidth <= 768) {
            dropdowns.forEach(dropdown => {
                const link = dropdown.querySelector('.nav-link');
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    dropdown.classList.toggle('active');
                });
            });
        }

        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            sidebar.classList.remove('active');
            contentPages.innerHTML = '';
            menuToggle.style.display = 'block';
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('active');
                }
            });
        }

        function saveContentItem(contentId) {
            if (!currentUser || !currentUser.isAdmin) return;
            
            const textarea = document.getElementById(`edit-${contentId}`);
            contentStorage[contentId] = textarea.value;
            const contentElement = document.getElementById(`content-${contentId}`);
            contentElement.innerHTML = renderMarkdown(contentStorage[contentId]);
            
            addSystemLog('content_edit', `–í—ñ–¥—Ä–µ–¥–∞–≥–æ–≤–∞–Ω–æ —Ä–æ–∑–¥—ñ–ª: ${getPageTitle(contentId)}`);
            
            saveContentToFirebase();
            
            alert('–ó–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –ø–æ–±–∞—á–∞—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.');
        }

        function getParentPage(contentId) {
            if (contentId.startsWith('exam-')) return 'exams';
            if (contentId.startsWith('lecture-')) return 'lectures';
            if (contentId.startsWith('training-')) return 'training';
            if (contentId.startsWith('instruction-')) return 'instructions';
            if (contentId.startsWith('task-')) return 'tasks';
            return 'home';
        }

        function getNavigationButtons(currentContentId, parentPage) {
            const currentCards = Object.keys(contentStorage)
                .filter(key => key.startsWith(parentPage.slice(0, -1)))
                .sort();
            
            const buttonHTML = currentCards.map(cardId => 
                cardId !== currentContentId ? 
                `<button class="nav-btn" onclick="showContentPage('${cardId}', '${getPageTitle(cardId)}')">${getPageTitle(cardId)}</button>` : 
                ''
            ).join('');

            return buttonHTML ? `
                <div class="nav-buttons">
                    ${buttonHTML}
                </div>
            ` : '';
        }

        function renderMarkdown(text) {
            if (!text) return '';
            
            let html = text;
            
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            
            html = html.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/gim, '<em>$1</em>');
            
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/gim, function(match, linkText, linkUrl) {
                let finalUrl = linkUrl.trim();
                if (!finalUrl.match(/^[a-zA-Z]+:\/\//)) {
                    finalUrl = 'https://' + finalUrl;
                }
                return '<a href="' + finalUrl + '" target="_blank" rel="noopener noreferrer" style="color: #5D8C42 !important; text-decoration: none !important; border-bottom: 1px solid #5D8C42; cursor: pointer !important;">' + linkText + '</a>';
            });
            
            html = html.replace(/\n/gim, '<br>');
            
            html = html.replace(/^- (.*$)/gim, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>)/gims, '<ul>$1</ul>');
            
            html = html.replace(/`([^`]+)`/gim, '<code style="background: rgba(13,15,21,0.8); padding: 2px 6px; border-radius: 4px;">$1</code>');
            html = html.replace(/```([^`]+)```/gims, '<pre style="background: rgba(13,15,21,0.8); padding: 15px; border-radius: 6px; overflow-x: auto;">$1</pre>');
            
            html = html.replace(/^> (.*$)/gim, '<blockquote style="border-left: 4px solid #5D8C42; padding-left: 15px; margin: 15px 0; color: #CCCCCC; font-style: italic;">$1</blockquote>');
            
            return html;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
        function initContentLinks() {
            document.addEventListener('click', function(e) {
                if (e.target.matches('.content-body a')) {
                    e.preventDefault();
                    const url = e.target.href;
                    window.open(url, '_blank', 'noopener,noreferrer');
                }
            });
        }

        // Nav links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.getAttribute('data-page');
                showPage(pageId);
                menuToggle.style.display = 'block';
            });
        });

        // Card clicks
        cards.forEach(card => {
            card.addEventListener('click', () => {
                const pageId = card.getAttribute('data-page');
                showPage(pageId);
            });
        });

        // Close sidebar when clicking outside
        document.addEventListener('click', (e) => {
            if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                sidebar.classList.remove('active');
                menuToggle.style.display = 'block';
                dropdowns.forEach(dropdown => dropdown.classList.remove('active'));
            }
        });

        // Close modals when clicking outside
        document.querySelector('.admin-overlay').addEventListener('click', closeAdminPanel);
        document.querySelector('.auth-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('auth-modal')) {
                document.querySelector('.auth-modal').classList.remove('active');
            }
        });
        document.querySelector('.card-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('card-modal')) {
                closeCardModal();
            }
        });
        document.querySelector('.media-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('media-modal')) {
                closeMediaModal();
            }
        });

        // Initialize
        initializeData();

        console.log(`
        ===== MILITARY ACADEMY WITH CARD MANAGEMENT =====
        Firebase: ${firebaseConfig.projectId}
        Card management: ACTIVE
        Logging system: ACTIVE
        Instructions section: ADDED
        Search system: ADDED
        Media system: ADDED
        Ready for use!
        `);
    </script>
</body>
</html>
